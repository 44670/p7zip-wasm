Description: CVE-2016-2335: UDF CInArchive::ReadFileItem code execution vulnerability
Origin: vendor, https://sourceforge.net/p/p7zip/discussion/383043/thread/9d0fb86b/#1dba
Bug-Debian: https://bugs.debian.org/824160
Bug-RedHat: https://bugzilla.redhat.com/show_bug.cgi?id=1335575
Forwarded: not-needed
Author: Salvatore Bonaccorso <carnil@debian.org>
Last-Update: 2016-06-08
Applied-Upstream: 16.00

===================================================================
--- a/CPP/7zip/Archive/Udf/UdfIn.cpp
+++ b/CPP/7zip/Archive/Udf/UdfIn.cpp
@@ -371,7 +371,11 @@ HRESULT CInArchive::ReadFileItem(int vol
     return S_FALSE;
   CFile &file = Files.Back();
   const CLogVol &vol = LogVols[volIndex];
-  CPartition &partition = Partitions[vol.PartitionMaps[lad.Location.PartitionRef].PartitionIndex];
+  unsigned partitionRef = lad.Location.PartitionRef;
+
+  if (partitionRef >= vol.PartitionMaps.Size())
+  	return S_FALSE;
+  CPartition &partition = Partitions[vol.PartitionMaps[partitionRef].PartitionIndex];
 
   UInt32 key = lad.Location.Pos;
   UInt32 value;
